"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),gaWrapper=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,t),this.prefix=e.prefix?e.prefix:"",this.testMode=e.testMode?e.testMode:!1,this.verbose=e.verbose?e.verbose:!1,this.enabled=!1,this.bindings=[],"function"==typeof ga&&(this.enabled=!0);var i=this;$(document).click(function(t){i._click(t)}),$(document).ready(function(){i.refresh()}),this.log("init"),this.testMode&&$("a").click(function(t){t.preventDefault()})}return _createClass(t,[{key:"bind",value:function(t,e){"function"==typeof e&&this.bindings.push({keyword:t,"function":e})}},{key:"refresh",value:function(){$("*[data-ga-bind-label]").each(function(t,e){console.log("inserted label"),$(e).find("*[data-ga-label]").attr("data-ga-label",$(e).attr("data-ga-bind-label"))}),$("*[data-ga-bind-action]").each(function(t,e){$(e).find("*[data-ga-action]").attr("data-ga-action",$(e).attr("data-ga-bind-action"))}),$("*[data-ga-bind-category]").each(function(t,e){$(e).find("*[data-ga-category]").attr("data-ga-category",$(e).attr("data-ga-bind-category"))})}},{key:"push",value:function(t,e,i){var n=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];if(this.checkGALoaded()){if(!n)return void this._push(t,e,i);t=this._fillBinding(n,t),e=this._fillBinding(n,e),i=this._fillBinding(n,i),this._push(t,e,i)}}},{key:"_push",value:function(t,e,i){if(this.checkGALoaded()){if(!t)return void this.log("push event received but category is undefined",0);if(!t.length)return void this.log("push event received but category is of length 0",0);if(!e)return void this.log("push event received but action is undefined",0);if(!e.length)return void this.log("push event received but action is of length 0",0);if(!i)return void this.log("push event received but label is undefined",0);if(!i.length)return void this.log("push event received but label is of length 0",0);this.log("pushed event (category: '"+this.prefix+t+"', action: '"+e+"', label: '"+i+"')"),this.testMode||ga("send","event",this.prefix+t,e,i)}}},{key:"_click",value:function(t){var e=$(t.target),i=this._hasAttr($(e),"data-ga-category"),n=this._hasAttr($(e),"data-ga-label"),a=this._hasAttr($(e),"data-ga-action");i||(i=$(e).closest("*[data-ga-category]")),n||(n=$(e).closest("*[data-ga-label]",i)),a||(a=$(e).closest("*[data-ga-action]",i)),n.length||(n=i),a.length||(a=i),"object"==typeof n&&(n=$(n).attr("data-ga-label")),"object"==typeof a&&(a=$(a).attr("data-ga-action")),"object"==typeof i&&(i=$(i).attr("data-ga-category")),this.push(i,a,n,e)}},{key:"_fillBinding",value:function(t,e){if(!e||!t)return!1;for(var i in this.bindings)e.indexOf("{{"+this.bindings[i].keyword+"}}")>-1&&(console.log(this.bindings[i]["function"].call(this,t)),e=e.replace("{{"+this.bindings[i].keyword+"}}",this.bindings[i]["function"].call(this,t)));return e.indexOf("{{")>-1&&e.indexOf("}}")>-1&&this.log("unrecognized binding in "+e+", ignoring",2),e}},{key:"checkGALoaded",value:function(){return"function"==typeof ga?(this.enabled=!0,!0):(this.enabled=!1,this.log("push event received but ga has not been loaded",2),!1)}},{key:"log",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?1:arguments[1];switch(e){case 0:e="WARNING";break;case 1:e="INFO";break;case 2:e="ERROR"}(this.verbose||2==e||0==e)&&console.log("gaw "+e+": "+t)}},{key:"_hasAttr",value:function(t,e){return e=$(t).attr(e),"undefined"!=typeof e&&e!==!1?e:!1}},{key:"prefix",set:function(t){this._prefix=t?t+"-":""},get:function(){return this._prefix}}]),t}();